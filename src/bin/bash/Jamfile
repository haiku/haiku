SubDir HAIKU_TOP src bin bash ;

SetSubDirSupportedPlatformsBeOSCompatible ;

if $(TARGET_PLATFORM) != haiku {
	UseHeaders [ FDirName $(HAIKU_TOP) headers posix ] : true ;
}

SubDirCcFlags -DHAVE_CONFIG_H -DPROGRAM='\"sh\"' -DCONF_HOSTTYPE='\"i586\"' -DCONF_OSTYPE='\"beos\"' -DCONF_MACHTYPE='\"i586-pc-beos\"' -DCONF_VENDOR='\"pc\"' -DSHELL ;

# filter warnings we don't want here
TARGET_WARNING_CCFLAGS = [ FFilter $(TARGET_WARNING_CCFLAGS)
	: -Wall -Wmissing-prototypes -Wsign-compare ] ;

SubDirSysHdrs [ FDirName $(SUBDIR) include ] ;
SubDirSysHdrs [ FDirName $(SUBDIR) lib ] ;
SubDirSysHdrs $(SUBDIR) ;

BuildPlatformMain mksyntax : 
	mksyntax.c ;

BuildPlatformMain mksignames : 
	mksignames.c ;

SEARCH on [ FGristFiles mksignames.c ] = [ FDirName $(SUBDIR) support ] ;

rule MkSyntaxExt
{
	MakeLocateArch $(<) ;
	Depends $(<) : mksyntax ;
	MkSyntaxExt1 $(<) : mksyntax ;
	LocalClean clean : $(<) ;
}

actions MkSyntaxExt1
{
	$(2) -o $(1) ;
}

MkSyntaxExt [ FGristFiles syntax.c ] ;

rule MkSignamesExt
{
	MakeLocateArch $(<) ;
	Depends $(<) : mksignames ;
	MkSignamesExt1 $(<) : mksignames ;
	LocalClean clean : $(<) ;
}

actions MkSignamesExt1
{
	$(2) $(1) ;
}

MkSignamesExt <bash>signames.h ;

BinCommand sh :
	parse.y shell.c eval.c general.c make_cmd.c print_cmd.c
	dispose_cmd.c execute_cmd.c variables.c version.c
	expr.c copy_cmd.c flags.c subst.c hashcmd.c hashlib.c mailcheck.c
	trap.c alias.c nojobs.c braces.c
	input.c bashhist.c array.c arrayfunc.c pathexp.c
	unwind_prot.c bashline.c bracecomp.c error.c
	list.c stringlib.c locale.c findcmd.c redir.c
	pcomplete.c pcomplib.c syntax.c xmalloc.c test.c sig.c
	: libreadline.a <bash>libglob.a libbuiltins.a libtilde.a libsh.a
	  libtermcap.a $(SELECT_UNAME_ETC_LIB)
	: bash.rdef ;

# trap.c includes signames.h
Includes [ FGristFiles trap.c ] : <bash>signames.h ;

# some sources include the generated builtext.h
Includes [ FGristFiles execute_cmd.c nojobs.c parse.c ] : <bash>builtext.h ;

SubInclude HAIKU_TOP src bin bash lib ;
SubInclude HAIKU_TOP src bin bash builtins ;
