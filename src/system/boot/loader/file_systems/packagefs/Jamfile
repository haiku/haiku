SubDir HAIKU_TOP src system boot loader file_systems packagefs ;

UsePrivateHeaders [ FDirName kernel boot platform $(TARGET_BOOT_PLATFORM) ] ;
UsePrivateHeaders kernel shared ;
UseBuildFeatureHeaders zlib ;

DEFINES += _BOOT_MODE ;

local kernelC++Header = [ FDirName $(HAIKU_TOP) headers private kernel util
	kernel_cpp.h ] ;

SubDirC++Flags -fno-rtti -include $(kernelC++Header) ;

SEARCH_SOURCE += [ FDirName $(HAIKU_TOP) src kits package ] ;
SEARCH_SOURCE += [ FDirName $(HAIKU_TOP) src kits package hpkg ] ;
SEARCH_SOURCE += [ FDirName $(HAIKU_TOP) src kits shared ] ;
SEARCH_SOURCE += [ FDirName $(HAIKU_TOP) src kits support ] ;


HAIKU_PACKAGE_FS_PACKAGE_READER_SOURCES =
	BlockBufferPool.cpp
	BlockBufferPoolImpl.cpp
	BufferDataOutput.cpp
	BufferPool.cpp
	DataReader.cpp
	ErrorOutput.cpp
	FDDataReader.cpp
	PackageContentHandler.cpp
	PackageData.cpp
	PackageDataReader.cpp
	PackageEntry.cpp
	PackageEntryAttribute.cpp
	PackageFileHeapAccessorBase.cpp
	PackageFileHeapReader.cpp
	PackageReaderImpl.cpp
	PoolBuffer.cpp
	ReaderImplBase.cpp
;

BootStaticLibrary boot_packagefs :
	packagefs.cpp
	PackageSettingsItem.cpp

	$(HAIKU_PACKAGE_FS_PACKAGE_READER_SOURCES)

	# compression
	DataIO.cpp
	ZlibCompressionBase.cpp
	ZlibDecompressor.cpp

	: -fno-pic
;

Includes [ FGristFiles $(HAIKU_PACKAGE_FS_PACKAGE_READER_SOURCES)
		ZlibCompressionBase.cpp ZlibDecompressor.cpp ]
	: [ BuildFeatureAttribute zlib : headers ] ;
