SubDir HAIKU_TOP src tests system boot loader file_systems tarfs ;

UsePrivateKernelHeaders ;
UsePrivateSystemHeaders ;
UsePrivateHeaders [ FDirName kernel disk_device_manager ] ;
UsePrivateHeaders shared storage ;
SubDirSysHdrs $(HAIKU_TOP) src tests system boot loader ;
SubDirSysHdrs $(HAIKU_TOP) headers libs zlib ;
SubDirHdrs $(HAIKU_TOP) src system boot loader file_systems tarfs ;

UseBuildFeatureHeaders zlib ;

Includes [ FGristFiles tarfs.cpp ]
	: [ BuildFeatureAttribute zlib : headers ] ;

ObjectDefines
	tarfs.cpp
	:
	_KERNEL_MODE _BOOT_MODE
	read_pos=boot_read_pos fstat=boot_fstat open=boot_open close=boot_close
	BOOT_ARCHIVE_IMAGE_OFFSET=$(HAIKU_BOOT_ARCHIVE_IMAGE_OFFSET)
	;

#SubDirCcFlags -DGUNZIP=1 ;

SEARCH_SOURCE += [ FDirName $(HAIKU_TOP) src libs zlib ] ;

StaticLibrary boottest_tarfs :
	tarfs.cpp
	: #-fcheck-memory-usage -D_NO_INLINE_ASM
	;

SEARCH on [ FGristFiles
		tarfs.cpp
	] = [ FDirName $(HAIKU_TOP) src system boot loader file_systems tarfs ] ;
