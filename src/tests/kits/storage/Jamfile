SubDir OBOS_TOP src tests kits storage ;

UsePrivateHeaders storage ;

CommonTestLib libstoragetest.so
	: StorageKitTestAddon.cpp
		AppFileInfoTest.cpp
		BasicTest.cpp
		DirectoryTest.cpp
		EntryTest.cpp
		FindDirectoryTest.cpp
		FileTest.cpp
		MimeSnifferTest.cpp
		MimeTypeTest.cpp
		NodeInfoTest.cpp
		NodeTest.cpp
		PathTest.cpp
		QueryTest.cpp
		ResourcesTest.cpp
		ResourceStringsTest.cpp
		StatableTest.cpp
		SymLinkTest.cpp
		TestApp.cpp
		VolumeTest.cpp
	: <boot!home!config!lib>libopenbeos.so be stdc++.r4
	: be stdc++.r4
	:
	: storage
;

# To run the tests some test files must be around.
{
	# OBOS
	local resdir = <storage!kit!test!files>resources ;
	MakeLocate $(resdir) : [ on UnitTesterHelper return $(LOCATE[1]) ] ;
	RelSymLink $(resdir) : [ FDirName $(SUBDIR) resources ] : false ;
	DEPENDS libstoragetest.so : $(resdir) ;
	# R5
	local resdir_r5 = <storage!kit!test!files!r5>resources ;
	MakeLocate $(resdir_r5) : [ on UnitTesterHelper_r5 return $(LOCATE[1]) ] ;
	RelSymLink $(resdir_r5) : [ FDirName $(SUBDIR) resources ] : false ;
	DEPENDS libstoragetest_r5.so : $(resdir_r5) ;
}

SubInclude OBOS_TOP src tests kits storage disk_device ;
SubInclude OBOS_TOP src tests kits storage virtualdrive ;
